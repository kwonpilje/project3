{% extends 'base.html' %}

{% block tab_title %} 
<title>Project | 고객 관리</title>
{% endblock %}

{% block title %}
안내 문자 전송
{% endblock %}

{% block lead %}
지연 및 결항편 이용 승객에게 안내 문자를 전송합니다.
{% endblock %}

{% block main_body %}
<div class="button_search">
  <form method="POST" action="/check_customer">
    <input name="flight_search" style="margin-bottom:10px" class="form-control" type="text" placeholder="예시: KE1234"/>
    <input type="submit" class="btn btn-primary" value="조회하기" style="margin-top: 20px; margin-bottom: 30px;"/>
  </form>
</div>

{% if doc %}
<table class="table">
  <thead>
    <tr>
      <th scope="col">편명</th>
      <th scope="col">출발공항</th>
      <th scope="col">도착공항</th>
      <th scope="col">운항 예측</th>
      <th scope="col">고객 관리</th>
      <th scope="col">삭제</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row">{{ doc.flight }}</th>
      <td>{{ doc.airport_ori }}</td>
      <td>{{ doc.airport_des }}</td>
      <td>{{ doc.prediction }}</td>

      <td>
        {% if result_msg %}
        <a class="btn btn-secondary", href='/send_msg/{{ doc.flight }}'>{{result_msg}}</a>
        {% else %}
        <!-- <a class="btn btn-secondary", href='/send_msg/{{ doc.flight }}' onclick="alert_msg()">안내문자 전송</a> -->
        <a class="btn btn-secondary", href='/send_msg/{{ doc.flight }}' onclick="sendTo()">안내문자 전송</a>
        <script>
          function alert_msg(){
          alert("문자 전송이 완료되었습니다.")
        }
        </script>

        <!-- 카카오 메시지 전송 시작-->
        <!-- <a id="send-to-btn" href="#" onclick="sendTo();"></a> -->
        <script type="text/javascript">
          function sendTo() {
            Kakao.init("7917d0cc51410de4108552ec0f626823")
            Kakao.Auth.login({
              scope: 'PROFILE,TALK_MESSAGE',
              success: function() {
                Kakao.API.request({
                  url: '/v2/api/talk/memo/default/send',
                  data: {
                    template_object: {
                      objectType: 'text',
                      text:
                        'hello, kakao',
                      link: {
                        mobile_web_url:
                          'https://developers.kakao.com/docs/js/kakaotalklink#텍스트-템플릿-보내기',
                        web_url:
                          'https://developers.kakao.com/docs/js/kakaotalklink#텍스트-템플릿-보내기',
                      },
                    },
                  },
                  success: function(res) {
                    alert('success: ' + JSON.stringify(res))
                  },
                  fail: function(err) {
                    alert('error: ' + JSON.stringify(err))
                  },
                })
              },
              fail: function(err) {
                alert('failed to login: ' + JSON.stringify(err))
              },
            })
          }
        </script>
        <!-- 카카오 메시지 전송 끝 -->



        {% endif %}
      </td>
      <td>
        <a class="btn btn-secondary", href='/check_customer/{{ doc.flight }}' onclick="delete_flight()">Delete</a>

        <script>
          function delete_flight(){
          alert("항공편 정보가 삭제되었습니다.")
        }
        </script>
      </td>
    </tr>
  </tbody>
</table>
{% endif %}


{% if result %}
<div class="result_search">
  <p>{{ result }}</p>
</div>
{% endif %}


{% endblock %}

